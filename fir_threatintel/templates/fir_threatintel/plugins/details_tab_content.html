{% load static %}
{% load i18n %}

<div class="tab-pane" data-query-endpoint="" data-observable-post="" id="tab_threatintel">
  {% trans "No intelligence available for this incident. Please check your configuration settings." %}
</div>

<script id="yeti-tab-data-template" type="text/x-handlebars-template">
  <span id="yeti-count">{% trans "Known: " %}${known.length}</span>
</script>

<script id="yeti-observables-template" type="text/x-handlebars-template">
  <div class="col-sm-12 widget order border-info-subtle yeti-matches">
    <h4 class="widget text-info-emphasis bg-info-subtle border border-info-subtle">{% trans "Observables" %}</h4>
    <div class="yeti-read">
      <table class="table table-condensed">
        ${#if known}
          <tbody>
            <tr>
              <th class="narrow"></th>
              <th>{% trans "Observable" %}</th>
              <th>{% trans "Tags" %}</th>
              <th>{% trans "YETI Context" %}</th>
            </tr>
            ${#each known}
              <tr>
                <td><a href="${url}" target="_blank"><span class="bi bi-box-arrow-up-right" aria-hidden="true"></span></a></td>
                <td><code>${value}</code></td>
                <td>${#each tags}<span class="badge badge-primary me-1">${this}</span>${/each}</td>
                <td>${join source ", "}</td>
              </tr>
            ${/each}
          </tbody>
        ${/if}
        ${#if unknown}
          <tbody>
              <tr>
                <th></th>
                <th>{% trans "Unknown observables" %}</th>
                <th></th>
                <th></th>
              </tr>
              ${#each unknown}
                <tr>
                  <td></td>
                  <td><code>${this}</code></td>
                  <td>N/A</td>
                  <td>N/A</td>
                </tr>
              ${/each}
          </tbody>
        ${/if}
      </table>
      <button class="btn btn-default btn-sm mb-2 mt-2 toggle-send-to-yeti" href="#">{% trans "Send to Yeti..." %}</button>
    </div>

    <div class="yeti-form d-none">
      <table class="table table-condensed">
        <tr>
          <th></th>
          <th>{% trans "Observable" %}</th>
          <th>{% trans "Tags" %}</th>
          <th>{% trans "YETI Context" %}</th>
        </tr>
        ${#if known}
          <tbody>
            ${#each known}
              <tr class="observable">
                <td><input type="checkbox" name="name" value=""></td>
                <td class="value"><code>${value}</code></td>
                <td class="tags">
                  <div class="tags-container">
                    <div class="tag-box"></div>
                    <input type="text" class="tagsinput" value="${#each tags}${this},${/each}">
                    <input type="hidden" class="tags-hidden" value="${#each tags}${this},${/each}">
                  </div>
                </td>
                <td class="context">${join source ", "}</td>
              </tr>
            ${/each}
          </tbody>
        ${/if}

        ${#if unknown}
          <tbody>
            <tr>
              <th></th>
              <th>{% trans "Unknown observables" %}</th>
              <th></th>
              <th></th>
            </tr>
            ${#each unknown}
              <tr class="observable">
                <td><input type="checkbox" name="name" value=""></td>
                <td class="value"><code>${this}</code></td>
                <td class="tags">
                  <div class="tags-container">
                    <div class="tag-box"></div>
                    <input type="text" class="tagsinput" value="">
                    <input type="hidden" class="tags-hidden" value="">
                  </div>
                </td>
                <td class="context">N/A</td>
              </tr>
            ${/each}
          </tbody>
        ${/if}
        <tbody>
          <tr>
            <td><input data-target="observable" class="check-all" type="checkbox" name="name" value=""></td>
            <td><strong><label>{% trans "Select all / tags for all observables" %}</label></strong></td>
            <td class="tags"><input type="text" class="tagsinput all-tags" value=""></td>
            <td></td>
          </tr>
        </tbody>
      </table>
      <button class="btn btn-outline-danger mt-2 me-2 send-to-yeti" href="#">{% trans "Send it!" %}<span class="bi bi-cloud-upload ms-1" aria-hidden="true"></span></button>
      {% blocktrans %}
        <strong>Note</strong>: Observables will be added with the following context:
      {% endblocktrans %}
      <code id="yeti-fid">{{ event.id }}</code>
      <button class="d-block btn btn-default btn-sm mb-2 mt-3 toggle-send-to-yeti" href="#">{% trans "Cancel" %}</button>
    </div>
  </div>
</script>
